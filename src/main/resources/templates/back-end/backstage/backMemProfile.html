<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>會員管理</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex">

<link rel="stylesheet" th:href="@{/css/style.default.premium.css}"
	id="theme-stylesheet">
  <link rel="stylesheet" th:href="@{/css/backMemProfile.css}">
  <!-- Custom stylesheet - for your changes-->
  <!-- Favicon-->
  <link href="https://fontawesome.com/icons/right-to-bracket?f=classic&s=solid" rel='stylesheet'>
  <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
    
  <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>

</head>

<body>
  <!-- Side Navbar -->
  <nav class="side-navbar">
    <div class="side-navbar-inner">
      <!-- Sidebar Header -->
      <div class="sidebar-header d-flex align-items-center justify-content-center p-3 mb-3">
        <!-- 左上大頭照區塊 -->
        <div class="sidenav-header-inner text-center"><a href="pages-profile.html"><h2 class="h5 text-white text-uppercase mb-0">Time後台管理</h2>
          <p class="text-sm mb-0 text-muted">Web Developer</p>
        </div>
        <!-- Small Brand information, appears on minimized sidebar-->
        <a class="brand-small text-center" href="index.html">
          <p class="h1 m-0">BD</p>
        </a>
      </div>
      <!-- Sidebar Navigation Menus -->
      <span class="text-uppercase text-gray-500 text-sm fw-bold letter-spacing-0 mx-lg-2 heading">Main</span>
      <ul class="list-unstyled">
        <li class="sidebar-item"><a class="sidebar-link" href="index.html">
            <svg class="svg-icon svg-icon-sm svg-icon-heavy me-2">
              <use xlink:href="#real-estate-1"> </use>
            </svg>Home </a></li>
            
        <li class="sidebar-item"><a class="sidebar-link" href="#formsDropdown" data-bs-toggle="collapse">
            <svg class="svg-icon svg-icon-sm svg-icon-heavy me-2">
              <use xlink:href="#survey-1"> </use>
            </svg>電影相關設定 </a>
          <ul class="collapse list-unstyled " id="formsDropdown">
            <li><a class="sidebar-link" href="forms.html">電影設定</a></li>
            <li><a class="sidebar-link" href="forms-advanced.html">圖片管理</a></li>
            <li><a class="sidebar-link" href="forms-autocomplete.html">場次管理</a></li>
            <li><a class="sidebar-link" href="forms-dropzone.html">影廳管理</a></li>
          </ul>
        </li>
        <li ><a class="sidebar-link" th:href="@{/backstage/backController}">
            <svg class="svg-icon svg-icon-sm svg-icon-heavy me-2">
            </svg>員工管理 </a></li>

            <li class="sidebar-item active"><a class="sidebar-link" th:href="@{/backstage/toMemProfile}">
              <svg class="svg-icon svg-icon-sm svg-icon-heavy me-2">
              </svg>會員管理 </a></li>
            
      </ul>
    </div>
  </nav>
  <div class="page">
    <!-- navbar -->
    <header class="header mb-5 pb-3">
      <nav class="nav navbar fixed-top">
        <div class="container-fluid">
          <div class="d-flex align-items-center justify-content-between w-100">
            <div class="d-flex align-items-center">
              <use xlink:href="#menu-1"> </use>
              </a>
              <div style="color: aliceblue; font-size: 20px ; margin-left: -30px;">會員資料管理</div>
            </div>
            <ul class="nav-menu mb-0 list-unstyled d-flex flex-md-row align-items-md-center">
              <!-- Notifications dropdown -->

              <!-- Messages dropdown -->

              <!-- Languages dropdown    -->
              <li class="nav-item dropdown">
                <ul class="dropdown-menu dropdown-menu-end mt-sm-3 shadow-sm" aria-labelledby="languages">
                </ul>
              </li>
              <!-- Log out-->
              <li class="nav-item"><a class="nav-link text-white text-sm ps-0" href="/empLogin/html/empLogin.html"> <span
                    class="d-none d-sm-inline-block">Logout</span>
                  <svg class="svg-icon svg-icon-xs svg-icon-heavy">
                    <use xlink:href="#security-1"> </use>
                  </svg></a></li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!------------------------------------- 內容放這裡 ---------------------------------------------->

    <!-----------------------------以下為列表--------------------->
    
    <table class="stripe custom-table" id="table_id" data-length-menu="[[10, 20, 30, -1], [10, 20, 30, &quot;All&quot;]]">
      <thead>
        <tr>
          <th>會員編號</th>
          <th>會員帳號</th>
          <th>姓名</th>
          <th>電話</th>
          <th>電子信箱</th>
          <th class="big">大頭照</th>
          <th>狀態</th>
        </tr>
      </thead>
      
     <tbody>
    <tr class="haha,red-text" th:each="mem : ${allMem}" >
        <td th:text="${mem.memberId}"></td>
        <td th:text="${mem.memberAccount}"></td>
        <td th:text="${mem.memberName}"></td>
        <td th:text="${mem.memberPhone}"></td>
        <td class="email" th:text="${mem.memberEmail}"></td>         
        
        <td class="imgg">    
		    <img th:if="${base64Images != null and base64Images[__${mem.memberId}__] != null}" 
     th:src="'data:image/jpeg;base64,' + ${base64Images[__${mem.memberId}__]}"
     style="width:120px; height:80px;">

			<img th:if="${base64Images[__${mem.memberId}__] == null}" 
			     src="/images/empPicture.jpg" 
			     alt="Default Image" 
			     style="width:120px; height:80px;">
        </td>
        
        
        <td>
  <button  th:id="'toggleButton_' + ${mem.memberId}"  class="custom-button" 
        th:attr="data-member-id=${mem.memberId}, data-status=${mem.memberStatus}"
        onclick="toMemStatus(this.getAttribute('data-member-id'), this.getAttribute('data-status'))" 
        th:text="${mem.memberStatus}">
</button>

        </td>
        
        
        
        
    </tr>
</tbody>
    </table>

    
    <!-- ----------------------------------------------------------------------------------------------------------------------------------------- -->
    <footer class="main-footer w-100 position-absolute bottom-0 start-0 py-2" style="background: #222">
      <div class="container-fluid">
        <div class="row text-center gy-3">
          <div class="col-sm-6 text-sm-start">
            <p class="mb-0 text-sm text-gray-600" >TimeMovie &copy; SINCE 2024</p>
          </div>
        </div>
      </div>
    </footer>
  </div>
  <div class="collapse" id="style-switch">
    <h5 class="mb-3">Select theme colour</h5>
    <form class="mb-3">
      <select class="form-select" name="colour" id="colour">
        <option value="">select colour variant</option>
        <option value="css/style.default.premium.css">green</option>
        <option value="css/style.red.premium.css">red</option>
        <option value="css/style.violet.premium.css">violet</option>
        <option value="css/style.pink.premium.css">pink</option>
        <option value="css/style.sea.premium.css">sea</option>
        <option value="css/style.blue.premium.css">blue</option>
      </select>
    </form>
    <p><img class="img-fluid" src="img/template-mac.png" alt=""></p>
    <p class="text-muted text-xs">Stylesheet switching is done via JavaScript and can cause a blink while page loads.
      This will not happen in your production code.</p>
  </div>
  <!-- JavaScript files-->
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="vendor/chart.js/Chart.min.js"></script>
  <script src="vendor/just-validate/js/just-validate.min.js"></script>
  <script src="vendor/choices.js/public/assets/scripts/choices.min.js"></script>
  <script src="vendor/overlayscrollbars/js/OverlayScrollbars.min.js"></script>
  <script src="js/demo.js"> </script>
  <!-- Main File-->
  <script src="js/front.js"></script>
  <script>
    // ------------------------------------------------------- //
    //   Inject SVG Sprite - 
    //   see more here 
    //   https://css-tricks.com/ajaxing-svg-sprite/
    // ------------------------------------------------------ //
    function injectSvgSprite(path) {
      var ajax = new XMLHttpRequest();
      ajax.open("GET", path, true);
      ajax.send();
      ajax.onload = function (e) {
        var div = document.createElement("div");
        div.className = 'd-none';
        div.innerHTML = ajax.responseText;
        document.body.insertBefore(div, document.body.childNodes[0]);
      }
    }
//--------------------------------------------------------------------//
  	function toMemStatus(memberId,memberStatus){
  		console.log( memberStatus,memberId); 
  		var newStatus= memberStatus==='啟用'?'停權':'啟用'; 
  		
  		$.ajax({
  	        type: "POST",
  	        url: "/backstage/toMemStatus",
  	        data: { memberId: memberId, newStatus: newStatus },
  	        
  	        success: function(response) {    
  	          $('#toggleButton_' + memberId).text(newStatus);
              // 更新按钮的 data-status 属性以便下次点击时使用
              $('#toggleButton_' + memberId).attr('data-status', newStatus);
              $('#toggleButton_' + memberId).toggleClass('red-text', newStatus === '停權');
        
  	        },
  	        
  	        error: function(xhr, status, error) {
  	            console.error("Error toggling member status:", error);
  	        }
  	    });		
  	}
  
  //--------------------------------------------------------------------// 
  
    $(document).ready(function() {
        $('#table_id').DataTable({
            searching: false, 
            ordering: false, 
            select: true,
            lengthMenu: JSON.parse(document.getElementById('table_id').getAttribute('data-length-menu')),
            pagingType: 'full_numbers', 
            language: {
                "lengthMenu": "顯示 _MENU_ 筆會員資料",
                "sInfo": "總共有 _MAX_ 筆會員資料",
                "oPaginate": {
                    "sFirst": "首頁",
                    "sPrevious": "上一頁",
                    "sNext": "下一頁",
                    "sLast": "末頁"
                }
            }
        });
    });

  </script>

</body>

</html>